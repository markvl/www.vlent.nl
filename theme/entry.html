{%- macro taglist() -%}
  {% if env.type != 'page' %}
    {% if 'tag' in env.views and entry.tags %}
      Tagged as
      {% for link in entry.tags | tagify -%}
        <a href="{{ env.path + link.href }}">{{ link.title }}</a>
        {%- if loop.revindex > 2 -%}
          ,
        {%- elif loop.revindex == 2 %}
          and
        {% endif %}
      {% endfor %}
    {% elif not entry.draft %}
      Untagged
    {% endif %}
  {% endif %}
{%- endmacro -%}
<article>
  <header>
    {% if env.type in ['index', 'tag'] %}
      <h2><a href="{{ env.path + entry.permalink }}">{{ entry.title | trim }}</a></h2>
    {% else %}
      <h1>{{ entry.title | trim }}</h1>
    {% endif %}
    <div class="metadata">
      {% if entry.type != 'page' %}
        <span class="publication-date">
          Published on <time datetime="{{ entry.date.strftime("%Y-%m-%d") }}">{{ entry.date.day }}&nbsp;{{ entry.date.strftime("%B")}},&nbsp;{{entry.date.year}}</time>
        </span>
        <span class="metadata-separator">|</span>
        <span class="taglist">
          {{ taglist() }}
        </span>
      {% endif %}
    </div>
  </header>
  {{ entry.content }}
  {%- if env.type == 'entry' %}
    {% if conf.disqus_shortname and not entry.draft %}
      <div class="comments">
         <button class="show-comments">Show comments</button>
        <div id="disqus_thread"></div>
        <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
        <script>
          var disqus_public_key = "{{ conf.disqus_key }}";
          var disqus_shortname = "{{ conf.disqus_shortname }}";
          var disqus_url = "{{ conf.www_root + entry.permalink }}";
          var disqus_identifier = "{{ entry.permalink }}";
          var thread_identifier = "ident:" + disqus_identifier;

          $.ajax({
              type: 'GET',
              url: 'https://disqus.com/api/3.0/threads/set.jsonp',
              data: { api_key: disqus_public_key, forum: disqus_shortname, thread: thread_identifier },
              cache: false,
              dataType: 'jsonp',
              success: function(result) {
                  if (result.response.length === 1) {
                      btnText = 'Show comments (' + result.response[0].posts + ')';
                      $('.show-comments').html(btnText);
                  }
              }
          });

          $('.show-comments').on('click', function() {
              $.ajaxSetup({cache:true});
              $.getScript('//' + disqus_shortname + '.disqus.com/embed.js');
              $.ajaxSetup({cache:false});
              $(this).remove();
          });

          if(/\#comment/.test(location.hash)){
              $('.show-comments').trigger('click');
          }
        </script>
        <noscript>
          <p>Please enable JavaScript to view the <a href="{{ env.protocol }}://disqus.com/?ref_noscript">comments powered by Disqus.</a></p>
        </noscript>
      </div>
    {% endif -%} {# show comments? #}

    <aside role="complementary">
      <p>If you find this blog interesting, you can subscribe to its <a data-icon="&#xe005;" href="/weblog/feed.atom">Atom feed</a>.</p>
    </aside>
  {% endif %} {# env.type == 'entry' ? #}
</article>
